## 2025-02-27 - [XSS from Linkification post-HTML Sanitization]
**Vulnerability:** The application was vulnerable to Cross-Site Scripting (XSS) due to how URLs were automatically converted into links (linkification) *after* the HTML had been sanitized. An attacker could inject a URL into an HTML attribute, which would pass sanitization (if the attribute was allowed), but then the subsequent linkification step would convert the URL string within the attribute into a full HTML `<a>` tag, breaking the HTML structure and executing arbitrary script (e.g. `onload=alert(1)`).
**Learning:** Performing regex-based linkification on raw HTML text is inherently dangerous if done *after* sanitization because it ignores the HTML context (e.g., text vs attributes). Using `textFilter` in `sanitize-html` is also tricky because the library automatically escapes the injected HTML (to prevent XSS payloads hiding in text), breaking the link rendering completely.
**Prevention:** Linkification should always be performed *before* HTML sanitization. This allows the regex to blindly inject `<a>` tags, which are then parsed into the DOM AST and properly validated/sanitized by `sanitize-html`. This approach safely removes any malicious payloads embedded within the injected URLs without breaking link rendering.
